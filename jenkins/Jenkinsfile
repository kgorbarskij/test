podTemplate(containers: [
    containerTemplate(name: 'dind', image: 'jenkins/jnlp-agent-docker', command: 'sleep', args: '99d'),
  ]) {

    node(POD_LABEL) {
        stage('Get project') {
            git 'https://github.com/kgorbarskij/test2.git'
            container('dind') {
                stage('Build project') {
                    sh 'docker build -t kgorbarskij/2048:latest .'
                    
                    withCredentials([usernamePassword(credentialsId: 'kgorbarskij_dhub', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD')]) {
                    sh """
                    docker login -u $USERNAME -p $PASSWORD
                    """
                    echo " ============== start pushing image =================="
                    sh '''
                    docker push kgorbarskij/2048:latest
                    '''
                    }   
                }
            }
        }
    }
}